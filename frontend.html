<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Mental Health Detection</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background:#eef2f8;
        padding:20px;
        margin:0;
    }
    .container {
        max-width: 700px;
        margin: auto;
        background: white;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    h2 {
        text-align:center;
        margin-bottom:20px;
    }
    textarea {
        width: 100%;
        height: 120px;
        padding: 12px;
        border-radius: 6px;
        border:1px solid #ccc;
        resize:none;
        margin-bottom:15px;
    }
    button {
        padding:10px 18px;
        margin:5px;
        border:none;
        background:#0056ff;
        color:white;
        border-radius:6px;
        cursor:pointer;
        font-size:15px;
    }
    button:hover {
        background:#003dcc;
    }
    #recordBtn {
        background:#ff3e3e;
    }
    #recordBtn.recording {
        background:#d60000;
    }
    .result-box {
        background:#f4f7ff;
        padding:15px;
        border-radius:6px;
        margin-top:20px;
        border-left:4px solid #0056ff;
        display:none;
    }
    pre {
        background:#efefef;
        padding:10px;
        border-radius:5px;
        white-space: pre-wrap;
    }
</style>
</head>
<body>

<div class="container">
    <h2>AI Mental Health Detection</h2>

    <label><b>Enter your statement</b></label>
    <textarea id="userText" placeholder="Type something..."></textarea>

    <button onclick="predictText()">Text Analysis</button>
    <button id="recordBtn" onclick="toggleRecording()">üé§ Record Voice</button>
    <button onclick="predictBoth()">Analyze Both</button>

    <div class="result-box" id="resultBox"></div>
</div>


<script>
let mediaRecorder;
let audioChunks = [];
let isRecording = false;
let lastRecordedBlob = null;


// ---------------------- TEXT PREDICTION -------------------------
async function predictText() {
    const text = document.getElementById("userText").value.trim();
    if (!text) return alert("Enter some text first!");

    const res = await fetch("http://127.0.0.1:8000/predict_text", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({text})
    });

    const data = await res.json();
    showResult(data);
}


// ---------------------- AUDIO RECORDING -------------------------
async function toggleRecording() {
    const recordBtn = document.getElementById("recordBtn");

    if (!isRecording) {
        let stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);

        mediaRecorder.ondataavailable = e => audioChunks.push(e.data);

        mediaRecorder.onstop = () => {
            const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
            audioChunks = [];

            lastRecordedBlob = audioBlob;  // ‚¨Ö store for fusion

            sendAudioForPrediction(audioBlob);
        };

        mediaRecorder.start();
        isRecording = true;
        recordBtn.classList.add("recording");
        recordBtn.textContent = "‚èπ Stop Recording";

    } else {
        mediaRecorder.stop();
        isRecording = false;
        recordBtn.classList.remove("recording");
        recordBtn.textContent = "üé§ Record Voice";
    }
}


// ---------------------- AUDIO PREDICTION -------------------------
async function sendAudioForPrediction(blob) {
    const formData = new FormData();
    formData.append("file", blob, "audio.wav");

    const res = await fetch("http://127.0.0.1:8000/predict_audio", {
        method: "POST",
        body: formData
    });

    const data = await res.json();
    showResult(data);
}


// ---------------------- FUSION (TEXT + AUDIO) -------------------------
async function predictBoth() {
    const text = document.getElementById("userText").value.trim();
    if (!text) return alert("Type something first!");

    if (!lastRecordedBlob) return alert("Record audio first!");

    const formData = new FormData();
    formData.append("text", text);
    formData.append("file", lastRecordedBlob, "audio.wav");

    const res = await fetch("http://127.0.0.1:8000/predict_both", {
        method: "POST",
        body: formData
    });

    const data = await res.json();
    showResult(data);
}


// ---------------------- SHOW RESULT -------------------------
function showResult(data) {
    const box = document.getElementById("resultBox");
    box.style.display = "block";

    box.innerHTML = `
        <h3>Result</h3>
        <pre>${JSON.stringify(data, null, 2)}</pre>
    `;
}
</script>

</body>
</html>
